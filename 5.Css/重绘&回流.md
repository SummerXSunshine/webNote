## 重绘&回流

### 浏览器渲染原理
1. 浏览器首先会根据html生成dom树。
2. 然后解析css生成cssom树。
3. 如果js又改变上面的内容会重新执行1，2两步。
4. js加载完成之后生成渲染树render tree。
5. Layout（回流）：根据render tree进行布局，得到节点的几何信息（位置，大小）。
6. Painting（重绘）：根据节点的几何位置，生成节点的绝对像素。
7. DIsplay：将像素发给GPU，在页面上进行展示。（GPU把多个合成层合并成一个层，这里还有css3硬件加速的原理-新增合成层）。

### 什么是回流

当render tree中的一部分(或全部)因为元素的规模尺寸，布局，隐藏等改变而需要重新构建。这就称为回流(reflow)。每个页面至少需要一次回流，就是在页面第一次加载的时候，这时候是一定会发生回流的，因为要构建render tree。在回流的时候，浏览器会使渲染树中受到影响的部分失效，并重新构造这部分渲染树，完成回流后，浏览器会重新绘制受影响的部分到屏幕中，该过程称为重绘。
#### 什么时候发生回流
从浏览器渲染原理来看,影响节点位置和大小的都会引起回流
- 添加或删除可见的DOM元素
- 元素的位置发生变化
- 元素的尺寸发生变化（包括外边距、内边框、边框大小、高度和宽度等）
- 内容发生变化，比如文本变化或图片被另一个不同尺寸的图片所替代。
- 页面一开始渲染的时候（这肯定避免不了）
- 浏览器的窗口尺寸变化（因为回流是根据视口的大小来计算元素的位置和大小的）

### 什么是重绘

当render tree中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如background-color。则就叫称为重绘。

### 区别
- 回流一定引起重绘，重绘不一定影响回流
- 颜色改变不会引起回流，但是页面布局和集合属性改变就需要回流（v-if）
- 通俗来讲，渲染就是画画，回流是在画物体的轮廓，重绘是在给物体上色。

> 因为回流的性能消耗大，浏览器会帮助我们优化这些操作，浏览器会维护1个队列，把所有会引起回流、重绘的操作放入这个队列，等队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会flush队列，进行一个批处理。这样就会让多次的回流、重绘变成一次回流重绘。

### 减少回流和重绘
#### css3加速
触发硬件加速的css属性
- transform
- opacity
- filter
- will-change

